{% extends 'header_footer/base.html' %}
{% load static %}

{% block title %}
  {% if page_user.hidden != True %}
    {{ page_user.family_name|title }} Family | Family+
  {% else %}
    Page Not Found | Family+
  {% endif %}
{% endblock %}

{% block content %}

<body style="background-color: #fff;">
  <section style="padding-top: 70px; min-height: 2000px;">
      {% if user.is_authenticated %}
        <div class="container-fluid" style="padding: 20px">
          <div class="row">

            <!-- Functions available only to the user -->
            {% if user.familyprofile.id == page_user.id %}
              <div class="col-md-3 offset-md-1">
                <a href=" {% url 'edit-family-profile' user.familyprofile.id %}" class="btn btn-secondary">
                  Edit Family Profile
                </a>
              </div>

              <div class="col-md-2 offset-md-6">
                <form action="{% url 'toggle-profile' user.familyprofile.pk %}" method="POST">{% csrf_token %}
                  {% if profile_hidden %}
                    <button type="submit", name="profile_id", value="{{ user.familyprofile.id }}" class="btn btn-primary">
                      Ready to Connect
                    </button>
                  {% else %}
                    <button type="submit", name="profile_id", value="{{ user.familyprofile.id }}" class="btn btn-secondary">
                      Hide Family Profile
                    </button>
                  {% endif %}
                </form>
              </div>

              <!-- Display family profile -->
              <div class="card mb-3" style="z-index: -1;">
                <div class="row g-0">
                  <div class="col-md-2">
                    <!-- Family profile image -->
                    {% if page_user.profile_image.url != "" %}
                      <img src="{{ page_user.profile_image.url }}" class="card-img rounded-circle">
                    {% else %}
                      <img src="{% static 'website/images/default_profile_img/plain_default3.jpg' %}" class="card-img rounded-circle">
                    {% endif %}
                  </div>
                  <div class="col-md-10">
                    <div class="card-body">
                      <br>
                      <h1 class="card-title">
                        <!-- Family nickname -->
                        {% if page_user.family_name %}
                          {{ page_user.family_name|title }} Family
                        {% else %}
                          (Set Up Nickname) Family
                        {% endif %}
                      </h1>
                      <br><br>
                      <p class="card-text">
                      <h3>Family bio</h3>
                      {{ page_user.family_bio }}
                      <br><br>

                      <h3>Contact Info</h3>
                      {% if page_user.contact_info %}
                        {{ page_user.contact_info }}
                      {% else %}

                        {% if page_user.user.family_name %}
                          The {{ page_user.user.family_name }} Family has not filled out this info.
                        {% else %}
                          This family has not filled out this info.
                        {% endif %}
                      {% endif %}
                      <br><br>

                      <!-- !!UNDER RECONSTRUCTION!! Only display these fields if filled out -->
                      <!-- {% if page_user.hobbies %}
                        <h3>Hobbies & Activities</h3>
                        {{ page_user.hobbies }}<br><br>
                      {% endif %}

                      {% if page_user.interests %}
                        <h3>Interests</h3>
                        {{ page_user.interests }}<br><br>
                      {% endif %}

                      {% if page_user.locations %}
                        <h3>Locations</h3>
                        {{ page_user.locations }}<br><br>
                      {% endif %}

                      {% if page_user.schedule %}
                        <h3>Availability</h3>
                        {{ page_user.schedule }}<br><br>
                      {% endif %}

                      {% if page_user.languages %}
                        <h3>Languages</h3>
                        {{ page_user.languages }}<br><br>
                      {% endif %}

                      <h3>Family Members</h3>
                      {{ page_user.family_members }}
                      <br><br> -->
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Display alternative info if the family profile is hidden -->
        {% if user.familyprofile.id != page_user.id %}
          {% if view_hidden %}
            {% include 'family_profile/hidden-profile.html' %}
          {% else %}

            <!-- Connect button, Cancel Request button, and Connection status -->
            {% if user in page_user.pending_requests.all %}
            <div class="col-md-2 offset-md-6">
              <form action="{% url 'cancel-request' page_user.pk %}" method="POST">{% csrf_token %}
                <button type="submit", name="profile_id_3", value="{{ page_user.id }}" class="btn btn-outline-danger">
                  Cancel Request
                </button>
              </form>
            </div>
          {% elif user in page_user.connections.all %}
            <button type="button" class="btn btn-success">
              Connection
            </button>
          {% else %}
            <div class="col-md-2 offset-md-6">
              <form action="{% url 'send-request' page_user.pk %}" method="POST">{% csrf_token %}
                <button type="submit", name="profile_id_2", value="{{ page_user.id }}" class="btn btn-primary">
                  Connect
                </button>
              </form>
            </div>
          {% endif %}
          <!-- End of Connect button, Cancel Request button, and Connection status -->

            <!-- Display family profile -->
            <div class="card mb-3" style="z-index: -1;">
              <div class="row g-0">
                <div class="col-md-2">
                  <!-- Family profile image -->
                  {% if page_user.profile_image.url != "" %}
                    <img src="{{ page_user.profile_image.url }}" class="card-img rounded-circle">
                  {% else %}
                    <img src="{% static 'website/images/default_profile_img/plain_default3.jpg' %}" class="card-img rounded-circle">
                  {% endif %}
                </div>
                <div class="col-md-10">
                  <div class="card-body">
                    <br>
                    <h1 class="card-title">
                      <!-- Family nickname -->
                      {% if page_user.family_name %}
                        {{ page_user.family_name|title }} Family
                      {% else %}
                        (Set Up Nickname) Family
                      {% endif %}
                    </h1>
                    <br><br>
                    <p class="card-text">
                    <h3>Family bio</h3>
                    {{ page_user.family_bio }}
                    <br><br>

                    <h3>Contact Info</h3>
                    {% if page_user.contact_info %}
                      {{ page_user.contact_info }}
                    {% else %}

                      {% if page_user.user.family_name %}
                        The {{ page_user.user.family_name|title }} Family has not filled out this info.
                      {% else %}
                        This family has not filled out this info.
                      {% endif %}
                    {% endif %}
                    <br><br>

                    <!-- !!UNDER RECONSTRUCTION!! Only display these fields if filled out -->
                    <!-- {% if page_user.hobbies %}
                      <h3>Hobbies & Activities</h3>
                      {{ page_user.hobbies }}<br><br>
                    {% endif %}

                    {% if page_user.interests %}
                      <h3>Interests</h3>
                      {{ page_user.interests }}<br><br>
                    {% endif %}

                    {% if page_user.locations %}
                      <h3>Locations</h3>
                      {{ page_user.locations }}<br><br>
                    {% endif %}

                    {% if page_user.schedule %}
                      <h3>Availability</h3>
                      {{ page_user.schedule }}<br><br>
                    {% endif %}

                    {% if page_user.languages %}
                      <h3>Languages</h3>
                      {{ page_user.languages }}<br><br>
                    {% endif %}

                    <h3>Family Members</h3>
                    {{ page_user.family_members }}
                    <br><br> -->
                    </p>

                  </div>
                </div>
              </div>
            </div>
          {% endif %}
        {% endif %}
      {% else %}
        <!-- Require logged in account to view family profiles -->
        <div class="container" style="padding: 290px;">
          You must be logged in to visit this page
        </div>
      {% endif %}

        {% if user.is_authenticated and user.familyprofile.id == page_user.id %}
          <!-- Connections Model Popup Box -->
          {% include 'family_profile/connections-list.html' %}
        {% endif %}

  </section>
</body>
{% endblock %}