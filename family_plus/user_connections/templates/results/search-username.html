{% extends 'header_footer/base.html' %}
{% load static %}

{% block title %}
  Search Results | Family+
{% endblock %}

{% block content %}
<body style="background-color: #f0f2f5;">
  <section style="padding-top: 70px; min-height: 2000px;">
    <center>
      {% if user.is_authenticated %}
        <div class="container" class="mx-auto">
          <br><h1>Results</h1>
          <h4>You searched for "{{ query }}"</h4>

          <!-- If text was entered in the search box display the results-->
          {% if search_results and query %}
            <a href="{% url 'search-page' %}">Search again</a><br>
            
            <!-- The resulting family profiles. Results only include those that have
            set up at least a family nickname. -->
            <div class="row">
              {% for family in search_results %}
                {% if family.familyprofile.family_name != "" %}
                  <div class="col">
                    {% if family.familyprofile.profile_image %}
                      <a href="{% url 'family-profile' family.familyprofile.id %}">
                        <img src="{{ family.familyprofile.profile_image.url }}" class="card-img rounded-circle"> 
                      </a> 
                    {% else %}
                      <a href="{% url 'family-profile' family.familyprofile.id %}">
                        <img src="{% static 'website/images/default_profile_img/plain_default3.jpg' %}" class="card-img rounded-circle">
                      </a>
                    {% endif %}
                    <h4>{{ family.familyprofile.family_name|title }} Family</h4><br>

                    <!-- Display connection statuses, possible actions, and link to family profiles -->
                    {% if user.familyprofile.user in family.familyprofile.pending_requests.all %}
                      <button type="button" class="btn btn-warning" disabled>
                        Request Sent
                      </button>
                      <a class="btn btn-secondary" href="{% url 'family-profile' family.familyprofile.id %}">
                        Visit Family Profile
                      </a>
                    {% elif user.familyprofile.user in family.familyprofile.connections.all %}
                      <button type="button" class="btn btn-success" disabled>
                        Connection
                      </button>
                      <a class="btn btn-secondary" href="{% url 'family-profile' family.familyprofile.id %}">
                        Visit Family Profile
                      </a>
                    {% else %}
                      <!--
                      Only provide link to family profile. There is no connect button
                      displayed here to help prevent spamming connect requests
                      -->
                      <a class="btn btn-secondary" href="{% url 'family-profile' family.familyprofile.id %}">
                        View to Connect
                      </a>
                    {% endif %}

                  </div>
                  {% if forloop.counter0 != 0 and forloop.counter0|divisibleby:2 == 0 %}
                    <div class="w-100"></div>
                  {% endif %}
                {% else %}
                  <!-- Users who haven't set up a family profile will have a default picture
                  and link to a Profile Not Found page. -->
                  <a href="{% url 'profile-not-found' %}">
                    <img src="{% static 'website/images/default_profile_img/plain_default3.jpg' %}" class="card-img rounded-circle">
                  </a>
                  <h5>Family profile not set up</h5><br>
                {% endif %}
            {% endfor %}
            </div>
          {% else %}
            {% include 'results/no-results.html' %}
          {% endif %}
        </div>

        <!-- Pagination -->
        {% if search_results and query %}
          {% include 'pagination/general_paginator.html' %}
        {% endif %}

      {% else %}
        <!-- Require logged in account to see search results -->
        <div class="container" style="padding: 290px">
          You must be logged in to visit this page.
        </div>
      {% endif %}
    </center>
  </section>
</body>
{% endblock %}